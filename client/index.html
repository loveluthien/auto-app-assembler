<!DOCTYPE html>
<html>
<head>
  <title>Mix 'N Match: Automatic App Assembler</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<link rel="stylesheet" href="style.css">


</head>
<body>

<header style="display: flex; align-items: center;">
    <div class="imgbox">
        <img class="center-fit" src="carta_logo.png" alt="CARTA Logo" style="height: 100px;">
    </div>
    <h1 id="header_title" style="margin-left: 10px;">CARTA Mix 'N Match: Auto App Assembler </h1>
    <button id="theme-switcher" style="margin-left:auto; margin-right:20px; padding:8px 16px;">Switch Theme</button>
    <div id="buildOverlay">
        <div id="overlayText">Assembling your App.<br>Please wait.</div>
    </div>
    <div id="busyOverlay">
        <div id="overlayText">The system is busy with another job.<br>Please wait.</div>
   </div>
</header>

<div style="margin: 20px 0; line-height: 1.5;">
    <p>Welcome to the CARTA Mix 'N Match: Auto App Assembler service!</p>
    <p>Instructions: Please select a current carta-frontend branch and carta-backend branch (The corresponding short commit ID is shown in brackets). Reload this webpage to see the latest commits.<br>
    You may click "Assemble Linux AppImage" to create an AppImage for Linux, or click "Assemble macOS Electron App" to create an Electron App for macOS.<br> 
    The app will proceed to be built in the background on the backend server. The build process is slow and may take approximately 45 minutes!<br>
    If the backend server is busy building an app for another user, the interface will be inaccessible with an overlay. If that is the case, please wait for the overlay to vanish. <br> 
    Once the build process is complete, your custom App will automatically appear in the Downloads list. You can identify it by the frontend and backend short commit IDs and the date e.g.; carta-&lt;frontend-commit&gt;-&lt;backend-commit&gt;-&lt;arch&gt;.AppImage<br>
    <p>Note:</p>
    <ul style="margin-top: -20px;">
        <li>The chosen carta-frontend and carta-backend branches must be using the same carta-protobuf versions.</li>
        <li>The branches selected must have been created after the v3.0 release.</li>
        <li>AppImage supports rhel8, rhel9, ubuntu22, and ubuntu24. Other OS and OS version is not guaranteed to work.</li>
        <li>The macOS Electron version can be 'arm64' (Apple Silicon) for macOS 12 Monterey and onward, or 'x64' (Intel) for macOS 11 Big Sur and onward.</li>
    </ul>
</div>


<div style="display: flex; flex-direction: row; align-items: flex-start; gap: 40px; margin-bottom: 40px;">
    <div style="flex: 2; display: flex; flex-direction: column; gap: 30px;">
        <div class="section">
            <h2 class="section-header">
                carta-frontend branch
            </h2>
            <select id="frontend-branch" style="width: 100%;"></select>
        </div>
        <div class="section">
            <h2 class="section-header">
                carta-backend branch
            </h2>
            <select id="backend-branch" style="width: 100%;"></select>
        </div>
        <div style="display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 20px; margin-top: 20px;">
            <button id="generate-button-linux-arm64" style="min-width:180px;">Assemble Linux arm64</button>
            <button id="generate-button-linux-x64" style="min-width:180px;">Assemble Linux x64</button>
            <button id="generate-button-macos-arm64" style="min-width:180px;">Assemble macOS arm64</button>
            <button id="generate-button-macos-x64" style="min-width:180px;">Assemble macOS x64</button>
        </div>
    </div>
    <div class="vertical-menu" style="flex: 1; margin-top: 0; min-width: 250px;">
            <h2>Download list</h2>
            <ul id="file-list"></ul>
    </div>
</div>

<script src="client.js"></script>
</body>
<script>
// Theme switcher logic
const themeSwitcher = document.getElementById('theme-switcher');
const root = document.documentElement;
function setTheme(theme, save = true) {
    if (theme === 'light') {
        document.body.classList.remove('dark-theme');
        document.body.classList.add('light-theme');
        if (save) localStorage.setItem('theme', 'light');
    } else {
        document.body.classList.remove('light-theme');
        document.body.classList.add('dark-theme');
        if (save) localStorage.setItem('theme', 'dark');
    }
}

// Listen for system appearance changes
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    setTheme('dark');
}

themeSwitcher.addEventListener('click', () => {
    if (document.body.classList.contains('dark-theme')) {
        setTheme('light');
    } else {
        setTheme('dark');
    }
});

// On load, use system appearance unless user has chosen a theme
const storedTheme = localStorage.getItem('theme');
if (storedTheme === 'light' || storedTheme === 'dark') {
    setTheme(storedTheme);
} else {
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    setTheme(prefersDark ? 'dark' : 'light', false);
}
</script>

</body>
</html>

